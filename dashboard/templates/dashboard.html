<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Trading Bot Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .metric-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }
        .metric-label {
            color: #666;
            font-size: 0.9em;
        }
        .status-badge {
            border-radius: 20px;
            padding: 5px 15px;
            font-size: 0.8em;
        }
        .status-passed { background: #28a745; color: white; }
        .status-rug_risk { background: #dc3545; color: white; }
        .status-fake_volume { background: #ffc107; color: black; }
        .refresh-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        .last-updated {
            font-size: 0.8em;
            color: #666;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="stats-card">
                    <h1 class="display-4">ðŸ¤– Crypto Trading Bot Dashboard</h1>
                    <p class="lead">Real-time monitoring of multi-chain token scanning and rug pull detection</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <span class="badge bg-success">Bot Status: Active</span>
                            <span class="badge bg-info ms-2">Chains: Solana, BSC, Ethereum</span>
                        </div>
                        <div class="last-updated" id="lastUpdated"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary Statistics -->
        <div class="row">
            <div class="col-md-2">
                <div class="metric-card text-center">
                    <div class="metric-value" id="totalScanned">0</div>
                    <div class="metric-label">Tokens Scanned</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="metric-card text-center">
                    <div class="metric-value" id="rugDetected">0</div>
                    <div class="metric-label">Rug Risks</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="metric-card text-center">
                    <div class="metric-value" id="fakeVolume">0</div>
                    <div class="metric-label">Fake Volume</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="metric-card text-center">
                    <div class="metric-value" id="passedChecks">0</div>
                    <div class="metric-label">Passed Checks</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="metric-card text-center">
                    <div class="metric-value" id="alertsSent">0</div>
                    <div class="metric-label">Alerts Sent</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="metric-card text-center">
                    <div class="metric-value" id="avgRiskScore">0</div>
                    <div class="metric-label">Avg Risk Score</div>
                </div>
            </div>
        </div>

        <!-- Chain Breakdown -->
        <div class="row">
            <div class="col-md-6">
                <div class="metric-card">
                    <h5>Chain Breakdown</h5>
                    <canvas id="chainChart" width="400" height="200"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                <div class="metric-card">
                    <h5>Status Distribution</h5>
                    <canvas id="statusChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- Recent Tokens -->
        <div class="row">
            <div class="col-12">
                <div class="metric-card">
                    <h5>Recent Token Scans</h5>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Token</th>
                                    <th>Symbol</th>
                                    <th>Chain</th>
                                    <th>Market Cap</th>
                                    <th>Risk Score</th>
                                    <th>Status</th>
                                    <th>Timestamp</th>
                                </tr>
                            </thead>
                            <tbody id="recentTokens">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Alerts -->
        <div class="row">
            <div class="col-12">
                <div class="metric-card">
                    <h5>Recent Alerts</h5>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Token</th>
                                    <th>Symbol</th>
                                    <th>Chain</th>
                                    <th>Risk Score</th>
                                    <th>Sent At</th>
                                </tr>
                            </thead>
                            <tbody id="recentAlerts">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Refresh Button -->
    <button class="btn btn-primary refresh-btn" onclick="refreshData()">
        <i class="fas fa-sync-alt"></i> Refresh
    </button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let chainChart, statusChart;

        function updateDashboard(data) {
            // Update summary statistics
            document.getElementById('totalScanned').textContent = data.summary.total_scanned;
            document.getElementById('rugDetected').textContent = data.summary.rug_detected;
            document.getElementById('fakeVolume').textContent = data.summary.fake_volume;
            document.getElementById('passedChecks').textContent = data.summary.passed_checks;
            document.getElementById('alertsSent').textContent = data.summary.alerts_sent;
            document.getElementById('avgRiskScore').textContent = data.summary.average_risk_score;
            
            // Update last updated time
            document.getElementById('lastUpdated').textContent = 
                'Last updated: ' + new Date(data.last_updated).toLocaleString();

            // Update chain breakdown chart
            updateChainChart(data.chain_breakdown);

            // Update recent tokens table
            updateRecentTokens(data.recent_tokens);
        }

        function updateChainChart(chainData) {
            const ctx = document.getElementById('chainChart').getContext('2d');
            
            if (chainChart) {
                chainChart.destroy();
            }

            chainChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(chainData),
                    datasets: [{
                        data: Object.values(chainData),
                        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function updateRecentTokens(tokens) {
            const tbody = document.getElementById('recentTokens');
            tbody.innerHTML = '';

            tokens.forEach(token => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${token.token_name || 'Unknown'}</td>
                    <td>${token.token_symbol || 'Unknown'}</td>
                    <td><span class="badge bg-secondary">${token.chain.toUpperCase()}</span></td>
                    <td>$${(token.market_cap || 0).toLocaleString()}</td>
                    <td>${(token.risk_score || 0).toFixed(1)}</td>
                    <td><span class="status-badge status-${token.status}">${token.status}</span></td>
                    <td>${new Date(token.timestamp).toLocaleString()}</td>
                `;
                tbody.appendChild(row);
            });
        }

        async function refreshData() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                updateDashboard(data);
            } catch (error) {
                console.error('Error refreshing data:', error);
            }
        }

        async function loadAlerts() {
            try {
                const response = await fetch('/api/alerts');
                const alerts = await response.json();
                
                const tbody = document.getElementById('recentAlerts');
                tbody.innerHTML = '';

                alerts.forEach(alert => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${alert.token_name || 'Unknown'}</td>
                        <td>${alert.token_symbol || 'Unknown'}</td>
                        <td><span class="badge bg-secondary">${alert.chain.toUpperCase()}</span></td>
                        <td>${(alert.risk_score || 0).toFixed(1)}</td>
                        <td>${new Date(alert.timestamp).toLocaleString()}</td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading alerts:', error);
            }
        }

        // Initial load
        document.addEventListener('DOMContentLoaded', function() {
            refreshData();
            loadAlerts();
            
            // Auto-refresh every 30 seconds
            setInterval(refreshData, 30000);
            setInterval(loadAlerts, 30000);
        });
    </script>
</body>
</html>